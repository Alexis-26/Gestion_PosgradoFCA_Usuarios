# global options
admin off
persist_config off
auto_https off
log {
	# runtime logs
	format json
}
servers {
	# server options
	trusted_proxies static private_ranges
}

:{$PORT} {
	# site block, listens on the $PORT environment variable, automatically assigned by railway
	log {
		# access logs
		format json
	}

	# serve from the '.web/_static' folder (reflex exports into the '.web/_static' folder)
	root * .web/_static

	# enable gzipping responses
	encode gzip

	# serve files from '.web/_static'
	file_server

	# allows for pretty paths
	try_files {path} {path}.html

	# the handle_path directive will strip /backend/ from the path before proxying
	handle_path /backend/* {
		# this strips the /backend/ prefix from the uri sent to the proxy address
		reverse_proxy 127.0.0.1:8000 # proxy all requests for /backend/* to the backend
	}

	# rewrite any errors to the corresponding error page
	handle_errors {
		rewrite * /{err.status_code}.html
		file_server
	}
}
